import{j as e,a as o,r as f}from"./client-58cc365f.js";import{B as R,a as v}from"./BreadCrumb-199df1aa.js";import{r as D,a as H}from"./api-f6f1a853.js";import{F as T}from"./FormSection-b5fa1c80.js";import{c as S,a as u,b as w,F as N}from"./index.esm-d15ecbe5.js";import{u as M,y as E,I as y}from"./Input-fb8632cd.js";import{F as A}from"./FormControl-5500baed.js";import{R as C,F as p,a as h}from"./RadioGroup-137a6be0.js";import{C as I}from"./Checkbox-c0828f60.js";import{r as V,d as q,a as L,e as P,u as k}from"./react-userarea-bbb4809d.js";import{n as $,o as z}from"./styled-1092f92f.js";import"./ArrowIcon-18cff6a5.js";import"./Request-e20e83b2.js";import"./SwitchBase-d5bfe78b.js";import"./hoist-non-react-statics.cjs-3f8ebaa8.js";import"./createSvgIcon-b56db109.js";const O={photos:[],ad:{title:"",description:"",phone_number:"",address:null,price:null,category_id:1,pricing_type:"price",delivery_type:1}},b={MODIFY_ADD:"MODIFY_ADD",ATTACH_PHOTOS:"ATTACH_PHOTOS",REMOVE_PHOTO:"REMOVE_PHOTO"},{MODIFY_ADD:j,ATTACH_PHOTOS:B,REMOVE_PHOTO:Z}=b,Y=(a,l)=>{switch(l.type){case j:return{...a,ad:{...a.ad,...l.payload}};case B:return{...a,photos:[...a.photos,...l.payload]};case Z:return{...a,photos:a.photos.filter(n=>n.src!==l.payload)};default:return a}},U=({files:a,onRemoveFile:l})=>a.length>0&&e("div",{className:"col-span-full flex flex-wrap gap-4 py-4",children:a.map(({src:n,name:s,sizeInKb:r,allowed:c})=>o("div",{className:`relative ring-2 ${c?"ring-x-green ring-opacity-20":"ring-red-500"} w-40 overflow-hidden rounded-md flex flex-col items-center justify-center gap-2 p-2`,children:[e("button",{type:"button",className:"bg-red-500 bg-opacity-50 hover:bg-opacity-100 duration-500 text-slate-50 absolute rounded-full text-xs px-2 py-1 left-1 top-1",onClick:l,"data-src":n,children:"حذف"}),!c&&e("span",{className:"bg-red-600 bg-opacity-80 text-slate-50 absolute rounded-full text-xs px-2 py-1 mx-2 text-center",children:"حجم عکس بیش از 500 کیلوبایت است"}),e("img",{className:"h-auto w-full",src:n,alt:s}),e("span",{className:"text-xs text-center",children:s}),o("span",{className:"text-xs text-center bg-gray-200 px-2 rounded-full",children:[Math.ceil(r*10)/10," کیلوبایت"]})]},n))}),G=S({title:u().required().min(3).max(80),description:u().required().min(3).max(600),delivery_type:w().oneOf([1,2,3]),pricing_type:u().required().oneOf(["negotiation","trade-off","price"]),price:w().integer().required().min(0).max(5e8),address:u().when("delivery_type",([a],l)=>a!==2?l.required():l.notRequired()),phone_number:u().required().matches(/09[0-9]{9}/),category_id:w().required()}),F=({className:a,children:l,...n})=>{var g;const s=f.useRef(null),[r,c]=f.useState(!1),i=M(n.name,(g=s.current)==null?void 0:g.value),d=r&&i&&i.errors.length;return o(T,{className:`col-span-full ${d?"text-red-600":"text-gray-600"}`,label:n.label?{for:n.id,text:`${n.label}${n.required?" *":""}`}:void 0,children:[e("textarea",{ref:s,className:`form-textarea ${d&&"invalid"} ${a}`,onBlur:()=>!r&&c(!0),...n}),d&&e("div",{className:"text-red-600 my-2 text-sm",children:i.errors.map(t=>e("span",{children:t},t))}),l]})},K=({handleSubmit:a,categories:l,submitting:n})=>{const s=f.useRef(null),[r,c]=f.useReducer(Y,O);function i(t,m){c({type:b.MODIFY_ADD,payload:{[t]:m}})}const d=t=>{if(!t.target.files||r.photos.length+t.target.files.length>10)return;let m=t.target.files;c({type:b.ATTACH_PHOTOS,payload:Array.from(m).map(x=>{let _=x.size/1024;return{file:x,allowed:_<=500,src:URL.createObjectURL(x),name:x.name,sizeInKb:_}})})},g=t=>{let m=t.currentTarget.getAttribute("data-src");c({type:b.REMOVE_PHOTO,payload:m}),setTimeout(()=>{URL.revokeObjectURL(m)},1e3)};return o("form",{className:"grid md:grid-cols-2 gap-4 md:gap-8 my-6 pb-6 px-3",onSubmit:t=>{t.preventDefault(),t.stopPropagation(),a(r)},children:[e(T,{label:{for:"category",text:"دسته بندی آگهی"},children:e("select",{onChange:t=>i("category_id",Number(t.target.value)),defaultValue:O.ad.category_id,name:"category",id:"category",className:"form-input py-1 pt-3 px-3",children:l.map(t=>e("option",{value:t.id,children:t.label},t.id))})}),o(E.Provider,{value:G,children:[e(y,{type:"text",name:"title",onChange:t=>i("title",t.target.value),maxLength:70,id:"title",label:"عنوان آگهی",className:"py-2 pt-3 px-3"}),e("div",{className:"col-span-full",children:o("div",{className:"relative md:w-1/2",children:[e("label",{htmlFor:"photos",className:"absolute -top-2 right-2 text-xs bg-white rounded-full px-2 text-gray-600",children:"تصاویر آگهی *"}),e("input",{onChange:d,ref:s,maxLength:70,accept:"image/*",id:"photos",type:"file",multiple:!0,name:"photos[]",className:"hidden"}),e("div",{onClick:()=>{var t;return(t=s.current)==null?void 0:t.click()},className:"form-input py-2 pt-3 px-3 cursor-pointer",children:o("button",{type:"button",className:"text-gray-700",children:["انتخاب فایل ",o("span",{className:"text-sm",children:["(",r.photos.length," از 10)"]})]})})]})}),e(U,{files:r.photos,onRemoveFile:g}),e(N,{text:"توضیحات تکمیلی",children:e("svg",{className:"ml-2",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"512",height:"512",children:o("g",{id:"_01_align_center","data-name":"01 align center",children:[e("path",{d:"M24,24H12.018A12,12,0,1,1,24,11.246l0,.063ZM12.018,2a10,10,0,1,0,0,20H22V11.341A10.018,10.018,0,0,0,12.018,2Z"}),e("rect",{x:"7",y:"7",width:"6",height:"2"}),e("rect",{x:"7",y:"11",width:"10",height:"2"}),e("rect",{x:"7",y:"15",width:"10",height:"2"})]})})}),e("div",{className:"col-span-full",children:o(A,{children:[e("label",{className:"text-gray-600 mb-2",children:"شیوه تعیین قیمت *"}),o(C,{row:!0,name:"controlled-radio-buttons-group",value:r.ad.pricing_type,onChange:t=>i("pricing_type",t.target.value),children:[e(p,{value:"price",control:e(h,{}),label:"قیمت پیشنهادی خودم"}),e(p,{value:"negotiation",control:e(h,{}),label:"توافقی"}),e(p,{value:"trade-off",control:e(h,{}),label:"معاوضه"})]})]})}),r.ad.pricing_type==="price"&&e(y,{id:"price",label:"قیمت کالا *",type:"text",onChange:t=>i("price",Number(t.target.value)||null),maxLength:9,minLength:5,name:"price",className:"ltr py-2 pt-3 px-3",children:typeof r.ad.price=="number"&&r.ad.price>0&&o("span",{className:"px-4 sticky left-0",children:[new Intl.NumberFormat("fa-IR").format(r.ad.price)," تومان"]})}),e(F,{label:"توضیحات آگهی *",onChange:t=>i("description",t.target.value),maxLength:600,id:"description",name:"description"}),e(N,{text:"اطلاعات تماس",children:e("svg",{className:"ml-2",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"512",height:"512",children:e("path",{d:"M23,11a1,1,0,0,1-1-1,8.008,8.008,0,0,0-8-8,1,1,0,0,1,0-2A10.011,10.011,0,0,1,24,10,1,1,0,0,1,23,11Zm-3-1a6,6,0,0,0-6-6,1,1,0,1,0,0,2,4,4,0,0,1,4,4,1,1,0,0,0,2,0Zm2.183,12.164.91-1.049a3.1,3.1,0,0,0,0-4.377c-.031-.031-2.437-1.882-2.437-1.882a3.1,3.1,0,0,0-4.281.006l-1.906,1.606A12.784,12.784,0,0,1,7.537,9.524l1.6-1.9a3.1,3.1,0,0,0,.007-4.282S7.291.939,7.26.908A3.082,3.082,0,0,0,2.934.862l-1.15,1C-5.01,9.744,9.62,24.261,17.762,24A6.155,6.155,0,0,0,22.183,22.164Z"})})}),e(y,{label:"شماره تلفن",onChange:t=>i("phone_number",t.target.value),id:"phone_number",type:"text",name:"phone_number",className:"ltr py-2 pt-3 px-3",placeholder:"مثال:‌ 09121234567",children:o("div",{className:"w-full flex items-center mt-2 px-2",children:[e("label",{className:"text-gray-700 font-bold text-xs cursor-pointer",htmlFor:"sms-only",children:"فقط از طریق پیامک پاسخگو هستم."}),e(I,{id:"sms-only",color:"default",size:"small"})]})}),e(y,{label:"تلفن ثابت",id:"address_line",type:"address_line",name:"address_line",className:"ltr py-2 pt-3 px-3",placeholder:"همراه با کد استان"}),e(N,{text:"تحویل کالا",children:e("svg",{className:"ml-2",height:"512",viewBox:"0 0 24 24",width:"512",xmlns:"http://www.w3.org/2000/svg",children:e("path",{d:"m21 0h-18a3 3 0 0 0 -3 3v21h24v-21a3 3 0 0 0 -3-3zm1 3v2h-7v-3h6a1 1 0 0 1 1 1zm-11-1h2v6h-2zm-8 0h6v3h-7v-2a1 1 0 0 1 1-1zm-1 20v-15h7v3h6v-3h7v15zm13-4h5v2h-5z"})})}),o(A,{children:[e("label",{className:"text-gray-600",children:"نوع تحویل *"}),o(C,{row:!0,name:"controlled-radio-buttons-group",value:r.ad.delivery_type.toString(),onChange:t=>i("delivery_type",Number(t.target.value)),children:[e(p,{value:"1",control:e(h,{}),label:"حضوری"}),e(p,{value:"2",control:e(h,{}),label:"غیرحضوری"}),e(p,{value:"3",control:e(h,{}),label:"هر دو"})]})]}),r.ad.delivery_type!==2&&e(F,{label:"منطقه محل تحویل",onChange:t=>i("address",t.target.value),id:"address",name:"address"})]}),e("div",{className:"col-span-full flex justify-center",children:e("button",{type:"submit",className:"text-lg duration-300 text-white bg-emerald-700 py-1 px-3 rounded-md border border-b-4 border-b-emerald-900/90 w-fit",children:n?"در حال ارسال":"ثبت آگهی"})})]})},pe=async({request:a})=>{let l=await a.formData(),[n,s]=D(l);const r=await n;return r.hasErrors()?r.getErrors():V("/ads")},he=async()=>{let a=null;try{const[l,n]=H(),s=await l;s.hasErrors()||(a=s.getContent())}catch{}return{categories:a}},ue=()=>{const a=q(),l=L();P();const{categories:n}=k(),s=r=>{try{const c=new FormData;r.photos.filter(i=>i.allowed).map(i=>{c.append("photos[]",i.file)}),Object.entries(r.ad).map(([i,d])=>{c.append(`ad[${i}]`,d||"")}),a(c,{method:"patch",action:"/ads/create",encType:"multipart/form-data"})}catch{}};return o($,{theme:z({typography:{fontFamily:"IranSansWeb"}}),children:[e("h1",{className:"font-bold text-2xl",children:"ایجاد آگهی جدید"}),o(R,{children:[e(v,{link:"/",children:"ناحیه کاربری"}),e(v,{link:"/ads",children:"آگهی ها"}),e(v,{children:"آگهی جدید"})]}),o("section",{className:"w-full xl:w-3/4 2xl:w-3/5 border border-black/5 shadow-md rounded-lg py-3 px-6",children:[o("h2",{className:"font-semibold text-xl text-gray-800 mt-4 mb-12 svg-inherit col-span-full",children:[e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"30",height:"30",children:e("path",{d:"M19.949,5.536,16.465,2.05A6.958,6.958,0,0,0,11.515,0H7A5.006,5.006,0,0,0,2,5V19a5.006,5.006,0,0,0,5,5H17a5.006,5.006,0,0,0,5-5V10.485A6.951,6.951,0,0,0,19.949,5.536ZM18.535,6.95A4.983,4.983,0,0,1,19.316,8H15a1,1,0,0,1-1-1V2.684a5.01,5.01,0,0,1,1.051.78ZM20,19a3,3,0,0,1-3,3H7a3,3,0,0,1-3-3V5A3,3,0,0,1,7,2h4.515c.164,0,.323.032.485.047V7a3,3,0,0,0,3,3h4.953c.015.162.047.32.047.485Z"})})," ","فرم ایجاد آگهی در ۳۸ فریم"]}),n&&e(K,{handleSubmit:s,categories:n,submitting:l.state==="submitting"})]})]})};export{ue as Component,pe as action,he as loader};
