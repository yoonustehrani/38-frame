import{j as e,a as n,r as N}from"./client-abbe1494.js";import{B as T,a as b}from"./BreadCrumb-3e3a8b10.js";import{r as R,a as D}from"./api-41aed6c4.js";import{F as H}from"./FormSection-0da77780.js";import{c as S,a as h,b as f,F as v}from"./index.esm-14f15176.js";import{y as M,I as g}from"./Input-4acd9be4.js";import{T as _}from"./TextArea-3a09a8ba.js";import{F as A}from"./FormControl-a430915d.js";import{R as C,F as p,a as m}from"./RadioGroup-98672c1f.js";import{C as I}from"./Checkbox-235d27fe.js";import{r as E,g as L,a as P,h as V,d as k}from"./Auth-85041acf.js";import{T as q,i as z}from"./styled-92600658.js";import"./ArrowIcon-202630a0.js";import"./Request-c3ee7f25.js";import"./SwitchBase-91e0191a.js";import"./hoist-non-react-statics.cjs-3f8ebaa8.js";import"./createSvgIcon-610a0a1c.js";const O={photos:[],ad:{title:"",description:"",phone_number:"",address:null,price:null,category_id:1,pricing_type:"price",delivery_type:1}},x={MODIFY_ADD:"MODIFY_ADD",ATTACH_PHOTOS:"ATTACH_PHOTOS",REMOVE_PHOTO:"REMOVE_PHOTO"},{MODIFY_ADD:j,ATTACH_PHOTOS:Z,REMOVE_PHOTO:B}=x,$=(a,l)=>{switch(l.type){case j:return{...a,ad:{...a.ad,...l.payload}};case Z:return{...a,photos:[...a.photos,...l.payload]};case B:return{...a,photos:a.photos.filter(i=>i.src!==l.payload)};default:return a}},U=({files:a,onRemoveFile:l})=>a.length>0&&e("div",{className:"col-span-full flex flex-wrap gap-4 py-4",children:a.map(({src:i,name:s,sizeInKb:r,allowed:c})=>n("div",{className:`relative ring-2 ${c?"ring-x-green ring-opacity-20":"ring-red-500"} w-40 overflow-hidden rounded-md flex flex-col items-center justify-center gap-2 p-2`,children:[e("button",{type:"button",className:"bg-red-500 bg-opacity-50 hover:bg-opacity-100 duration-500 text-slate-50 absolute rounded-full text-xs px-2 py-1 left-1 top-1",onClick:l,"data-src":i,children:"حذف"}),!c&&e("span",{className:"bg-red-600 bg-opacity-80 text-slate-50 absolute rounded-full text-xs px-2 py-1 mx-2 text-center",children:"حجم عکس بیش از 500 کیلوبایت است"}),e("img",{className:"h-auto w-full",src:i,alt:s}),e("span",{className:"text-xs text-center",children:s}),n("span",{className:"text-xs text-center bg-gray-200 px-2 rounded-full",children:[Math.ceil(r*10)/10," کیلوبایت"]})]},i))}),Y=S({title:h().required().min(3).max(80),description:h().required().min(3).max(600),delivery_type:f().oneOf([1,2,3]),pricing_type:h().required().oneOf(["negotiation","trade-off","price"]),price:f().integer().required().min(0).max(5e8),address:h().when("delivery_type",([a],l)=>a!==2?l.required():l.notRequired()),phone_number:h().required().matches(/09[0-9]{9}/),category_id:f().required()}),G=({handleSubmit:a,categories:l,submitting:i})=>{const s=N.useRef(null),[r,c]=N.useReducer($,O);function o(t,d){c({type:x.MODIFY_ADD,payload:{[t]:d}})}const y=t=>{if(!t.target.files||r.photos.length+t.target.files.length>10)return;let d=t.target.files;c({type:x.ATTACH_PHOTOS,payload:Array.from(d).map(u=>{let w=u.size/1024;return{file:u,allowed:w<=500,src:URL.createObjectURL(u),name:u.name,sizeInKb:w}})})},F=t=>{let d=t.currentTarget.getAttribute("data-src");c({type:x.REMOVE_PHOTO,payload:d}),setTimeout(()=>{URL.revokeObjectURL(d)},1e3)};return n("form",{className:"grid md:grid-cols-2 gap-4 md:gap-8 my-6 pb-6 px-3",onSubmit:t=>{t.preventDefault(),t.stopPropagation(),a(r)},children:[e(H,{label:{for:"category",text:"دسته بندی آگهی"},children:e("select",{onChange:t=>o("category_id",Number(t.target.value)),defaultValue:O.ad.category_id,name:"category",id:"category",className:"form-input py-1 pt-3 px-3",children:l.map(t=>e("option",{value:t.id,children:t.label},t.id))})}),n(M.Provider,{value:Y,children:[e(g,{type:"text",name:"title",onChange:t=>o("title",t.target.value),maxLength:70,id:"title",label:"عنوان آگهی",className:"py-2 pt-3 px-3"}),e("div",{className:"col-span-full",children:n("div",{className:"relative md:w-1/2",children:[e("label",{htmlFor:"photos",className:"absolute -top-2 right-2 text-xs bg-white rounded-full px-2 text-gray-600",children:"تصاویر آگهی *"}),e("input",{onChange:y,ref:s,maxLength:70,accept:"image/*",id:"photos",type:"file",multiple:!0,name:"photos[]",className:"hidden"}),e("div",{onClick:()=>{var t;return(t=s.current)==null?void 0:t.click()},className:"form-input py-2 pt-3 px-3 cursor-pointer",children:n("button",{type:"button",className:"text-gray-700",children:["انتخاب فایل ",n("span",{className:"text-sm",children:["(",r.photos.length," از 10)"]})]})})]})}),e(U,{files:r.photos,onRemoveFile:F}),e(v,{text:"توضیحات تکمیلی",children:e("svg",{className:"ml-2",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"512",height:"512",children:n("g",{id:"_01_align_center","data-name":"01 align center",children:[e("path",{d:"M24,24H12.018A12,12,0,1,1,24,11.246l0,.063ZM12.018,2a10,10,0,1,0,0,20H22V11.341A10.018,10.018,0,0,0,12.018,2Z"}),e("rect",{x:"7",y:"7",width:"6",height:"2"}),e("rect",{x:"7",y:"11",width:"10",height:"2"}),e("rect",{x:"7",y:"15",width:"10",height:"2"})]})})}),e("div",{className:"col-span-full",children:n(A,{children:[e("label",{className:"text-gray-600 mb-2",children:"شیوه تعیین قیمت *"}),n(C,{row:!0,name:"controlled-radio-buttons-group",value:r.ad.pricing_type,onChange:t=>o("pricing_type",t.target.value),children:[e(p,{value:"price",control:e(m,{}),label:"قیمت پیشنهادی خودم"}),e(p,{value:"negotiation",control:e(m,{}),label:"توافقی"}),e(p,{value:"trade-off",control:e(m,{}),label:"معاوضه"})]})]})}),r.ad.pricing_type==="price"&&e(g,{id:"price",label:"قیمت کالا *",type:"text",onChange:t=>o("price",Number(t.target.value)||null),maxLength:9,minLength:5,name:"price",className:"ltr py-2 pt-3 px-3",children:typeof r.ad.price=="number"&&r.ad.price>0&&n("span",{className:"px-4 sticky left-0",children:[new Intl.NumberFormat("fa-IR").format(r.ad.price)," تومان"]})}),e(_,{label:"توضیحات آگهی *",onChange:t=>o("description",t.target.value),maxLength:600,id:"description",name:"description"}),e(v,{text:"اطلاعات تماس",children:e("svg",{className:"ml-2",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"512",height:"512",children:e("path",{d:"M23,11a1,1,0,0,1-1-1,8.008,8.008,0,0,0-8-8,1,1,0,0,1,0-2A10.011,10.011,0,0,1,24,10,1,1,0,0,1,23,11Zm-3-1a6,6,0,0,0-6-6,1,1,0,1,0,0,2,4,4,0,0,1,4,4,1,1,0,0,0,2,0Zm2.183,12.164.91-1.049a3.1,3.1,0,0,0,0-4.377c-.031-.031-2.437-1.882-2.437-1.882a3.1,3.1,0,0,0-4.281.006l-1.906,1.606A12.784,12.784,0,0,1,7.537,9.524l1.6-1.9a3.1,3.1,0,0,0,.007-4.282S7.291.939,7.26.908A3.082,3.082,0,0,0,2.934.862l-1.15,1C-5.01,9.744,9.62,24.261,17.762,24A6.155,6.155,0,0,0,22.183,22.164Z"})})}),e(g,{label:"شماره تلفن",onChange:t=>o("phone_number",t.target.value),id:"phone_number",type:"text",name:"phone_number",className:"ltr py-2 pt-3 px-3",placeholder:"مثال:‌ 09121234567",children:n("div",{className:"w-full flex items-center mt-2 px-2",children:[e("label",{className:"text-gray-700 font-bold text-xs cursor-pointer",htmlFor:"sms-only",children:"فقط از طریق پیامک پاسخگو هستم."}),e(I,{id:"sms-only",color:"default",size:"small"})]})}),e(g,{label:"تلفن ثابت",id:"address_line",type:"address_line",name:"address_line",className:"ltr py-2 pt-3 px-3",placeholder:"همراه با کد استان"}),e(v,{text:"تحویل کالا",children:e("svg",{className:"ml-2",height:"512",viewBox:"0 0 24 24",width:"512",xmlns:"http://www.w3.org/2000/svg",children:e("path",{d:"m21 0h-18a3 3 0 0 0 -3 3v21h24v-21a3 3 0 0 0 -3-3zm1 3v2h-7v-3h6a1 1 0 0 1 1 1zm-11-1h2v6h-2zm-8 0h6v3h-7v-2a1 1 0 0 1 1-1zm-1 20v-15h7v3h6v-3h7v15zm13-4h5v2h-5z"})})}),n(A,{children:[e("label",{className:"text-gray-600",children:"نوع تحویل *"}),n(C,{row:!0,name:"controlled-radio-buttons-group",value:r.ad.delivery_type.toString(),onChange:t=>o("delivery_type",Number(t.target.value)),children:[e(p,{value:"1",control:e(m,{}),label:"حضوری"}),e(p,{value:"2",control:e(m,{}),label:"غیرحضوری"}),e(p,{value:"3",control:e(m,{}),label:"هر دو"})]})]}),r.ad.delivery_type!==2&&e(_,{label:"منطقه محل تحویل",onChange:t=>o("address",t.target.value),id:"address",name:"address"})]}),e("div",{className:"col-span-full flex justify-center",children:e("button",{type:"submit",className:"text-lg duration-300 text-white bg-emerald-700 py-1 px-3 rounded-md border border-b-4 border-b-emerald-900/90 w-fit",children:i?"در حال ارسال":"ثبت آگهی"})})]})},me=async({request:a})=>{let l=await a.formData(),[i,s]=R(l);const r=await i;return r.hasErrors()?r.getErrors():E("/ads")},he=async()=>{let a=null;try{const[l,i]=D(),s=await l;s.hasErrors()||(a=s.getContent())}catch{}return{categories:a}},ue=()=>{const a=L(),l=P();V();const{categories:i}=k(),s=r=>{try{const c=new FormData;r.photos.filter(o=>o.allowed).map(o=>{c.append("photos[]",o.file)}),Object.entries(r.ad).map(([o,y])=>{c.append(`ad[${o}]`,y||"")}),a(c,{method:"patch",action:"/ads/create",encType:"multipart/form-data"})}catch{}};return n(q,{theme:z({typography:{fontFamily:"IranSansWeb"}}),children:[e("h1",{className:"font-bold text-2xl",children:"ایجاد آگهی جدید"}),n(T,{children:[e(b,{link:"/",children:"ناحیه کاربری"}),e(b,{link:"/ads",children:"آگهی ها"}),e(b,{children:"آگهی جدید"})]}),n("section",{className:"w-full xl:w-3/4 2xl:w-3/5 border border-black/5 shadow-md rounded-lg py-3 px-6",children:[n("h2",{className:"font-semibold text-xl text-gray-800 mt-4 mb-12 svg-inherit col-span-full",children:[e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"30",height:"30",children:e("path",{d:"M19.949,5.536,16.465,2.05A6.958,6.958,0,0,0,11.515,0H7A5.006,5.006,0,0,0,2,5V19a5.006,5.006,0,0,0,5,5H17a5.006,5.006,0,0,0,5-5V10.485A6.951,6.951,0,0,0,19.949,5.536ZM18.535,6.95A4.983,4.983,0,0,1,19.316,8H15a1,1,0,0,1-1-1V2.684a5.01,5.01,0,0,1,1.051.78ZM20,19a3,3,0,0,1-3,3H7a3,3,0,0,1-3-3V5A3,3,0,0,1,7,2h4.515c.164,0,.323.032.485.047V7a3,3,0,0,0,3,3h4.953c.015.162.047.32.047.485Z"})})," ","فرم ایجاد آگهی در ۳۸ فریم"]}),i&&e(G,{handleSubmit:s,categories:i,submitting:l.state==="submitting"})]})]})};export{ue as Component,me as action,he as loader};
